name: Turnpage Networks Transformation
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  transform-and-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Add transform script
        run: |
          cat > turnpage_transform.py << 'PY'
# Minimal in-repo transformer (string replacements and common assets)
import os, re, sys
from pathlib import Path

root = Path(".")
exts = {".html",".htm",".css",".js",".php",".tpl",".md",".txt"}

text_map = {
  "Localhost": "Turnpage Networks",
  "localhost": "Turnpage Networks",
  "LOCALHOST": "TURNPAGE NETWORKS",
  "Localhost - Web Hosting Template with WHMCS + RTL": "Turnpage Networks - Business Website Design & WordPress Hosting",
  "Elevate your hosting business": "Transform your business online with professional website design",
  "web hosting services": "business website design and hosting services",
  "hosting provider": "business website design and hosting provider",
  "Shared Web Hosting": "Business WordPress Hosting",
  "VPS Hosting": "Managed Business Hosting",
  "Dedicated Hosting": "Enterprise Business Hosting",
  "WordPress Hosting": "Business WordPress Development",
  "Sign up - Free Trial": "Start Your Business Website Project",
  "Get Started now": "Get Your Business Website Quote",
}

def replace_in_file(p: Path):
    try:
        txt = p.read_text(encoding="utf-8", errors="ignore")
    except Exception:
        return False, []
    orig = txt
    changes = []
    for old, new in text_map.items():
        if old in txt:
            c = txt.count(old)
            txt = txt.replace(old, new)
            changes.append(f"{old} -> {new} ({c})")
    if txt != orig:
        p.write_text(txt, encoding="utf-8")
        return True, changes
    return False, []

changed = 0
log = []
for rp, _, files in os.walk(root):
    for f in files:
        p = Path(rp) / f
        if p.suffix.lower() in exts:
            ok, ch = replace_in_file(p)
            if ok:
                changed += 1
                for line in ch:
                    log.append(f"{p}: {line}")

Path("transformation_report.txt").write_text("
".join(log), encoding="utf-8")
print(f"Files changed: {changed}")
PY

      - name: Run transform
        run: |
          python3 turnpage_transform.py
          echo "=== Preview of changes ==="
          tail -n 50 transformation_report.txt || true

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore: Transform to Turnpage Networks (business website design + WP hosting)"
          title: "Transform: Turnpage Networks branding and business focus"
          body: |
            Automated transformation:
            - Replace “Localhost” with “Turnpage Networks”
            - Shift content to Business Website Design & WordPress Hosting
            - Update common labels and CTAs
            See transformation_report.txt for details.
          branch: turnpage/branding-and-content
          base: ${{ github.event.repository.default_branch }}